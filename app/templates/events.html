<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–ª–æ–Ω—Ç–µ—Ä–ü–∞—Ä–∫</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/events.css">
</head>

<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ä—Ç—ã -->
    <div class="map-page" id="mapPage">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="/">üåø –í–æ–ª–æ–Ω—Ç–µ—Ä–ü–∞—Ä–∫</a>
                <div class="navbar-nav ml-auto">
                    <a class="btn btn-outline-light btn-sm" href="/">
                        ‚Üê –ù–∞–∑–∞–¥
                    </a>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- –ú–µ–Ω—é -->
            <div class="menu-icon" id="menuButton">
                <div class="menu-line"></div>
                <div class="menu-line"></div>
                <div class="menu-line"></div>
            </div>
            <div class="sidebar" id="sidebar">
                {% if not user_id %}
                <a href="/login" class="menu-item">
                    –í–æ–π—Ç–∏
                </a>
                {% else %}
                <a href="/profile" class="menu-item">
                    –ü—Ä–æ—Ñ–∏–ª—å
                </a>
                {% endif %}
                <a href="#" class="menu-item" onclick="showParksPage()">–ü–∞—Ä–∫–∏</a>
                {% if user_id %}
                <a href="/logout" class="menu-item">–í—ã–π—Ç–∏</a>
                {% endif %}
            </div>

            <div class="row fade-in text-center">
                <div class="col-12 py-5">
                    <h2><b>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</b></h2>
                    <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —É–±–æ—Ä–∫–∞–º –≤ –ø–∞—Ä–∫–∞—Ö –ú–æ—Å–∫–≤—ã</p>
                </div>
            </div>

            <div class="row">
                <!-- –ö–∞—Ä—Ç–∞ -->
                <div class="col-12 mb-4">
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
                <div class="col-12">
                    <div class="events-sidebar">
                        <h5 style="color: #112b00; margin-bottom: 20px;">–ë–ª–∏–∂–∞–π—à–∏–µ —É–±–æ—Ä–∫–∏</h5>

                        <div class="event-card" data-lat="55.728955" data-lng="37.603579"
                            onclick="focusOnEvent('gorky')" id="card-gorky">
                            <div class="event-date">25 –Ω–æ—è–±—Ä—è, 10:00-13:00</div>
                            <h6>–£–±–æ—Ä–∫–∞ –≤ –ü–∞—Ä–∫–µ –ì–æ—Ä—å–∫–æ–≥–æ</h6>
                            <div class="event-location">–ö—Ä—ã–º—Å–∫–∏–π –í–∞–ª, 9</div>
                            <p style="font-size: 14px; color: #555;">–°–±–æ—Ä —É –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –í–∑—è—Ç—å —Å —Å–æ–±–æ–π: –ø–∞–∫–µ—Ç—ã,
                                –≥—Ä–∞–±–ª–∏, –ø–µ—Ä—á–∞—Ç–∫–∏.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: #888;"></span>
                                <button class="btn-volunteer"
                                    onclick="event.stopPropagation(); joinEvent('gorky')">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>

                        <div class="event-card" data-lat="55.709683" data-lng="37.597258"
                            onclick="focusOnEvent('neskuchny')" id="card-neskuchny">
                            <div class="event-date">15 –¥–µ–∫–∞–±—Ä—è, 14:00-17:00</div>
                            <h6>–£–±–æ—Ä–∫–∞ –≤ –ù–µ—Å–∫—É—á–Ω–æ–º —Å–∞–¥—É</h6>
                            <div class="event-location">–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 20</div>
                            <p style="font-size: 14px; color: #555;">–°–±–æ—Ä —É –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –í–∑—è—Ç—å —Å —Å–æ–±–æ–π: –ª–æ–ø–∞—Ç—É.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: #888;"></span>
                                <button class="btn-volunteer"
                                    onclick="event.stopPropagation(); joinEvent('neskuchny')">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>

                        <div class="event-card" data-lat="55.791348" data-lng="37.677933"
                            onclick="focusOnEvent('sokolniki')" id="card-sokolniki">
                            <div class="event-date">20 –¥–µ–∫–∞–±—Ä—è, 11:00-14:00</div>
                            <h6>–£–±–æ—Ä–∫–∞ –≤ –°–æ–∫–æ–ª—å–Ω–∏–∫–∞—Ö</h6>
                            <div class="event-location">–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∏–π –í–∞–ª, 1</div>
                            <p style="font-size: 14px; color: #555;">–°–±–æ—Ä —É –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –í–∑—è—Ç—å —Å —Å–æ–±–æ–π: –ª–æ–ø–∞—Ç—É.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: #888;"></span>
                                <button class="btn-volunteer"
                                    onclick="event.stopPropagation(); joinEvent('sokolniki')">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>

                        <div class="event-card" data-lat="55.787152" data-lng="37.771609"
                            onclick="focusOnEvent('izmaily')" id="card-izmaily">
                            <div class="event-date">25 –¥–µ–∫–∞–±—Ä—è, 12:00-15:00</div>
                            <h6>–ü—Ä–µ–¥–Ω–æ–≤–æ–≥–æ–¥–Ω—è—è —É–±–æ—Ä–∫–∞ –≤ –ò–∑–º–∞–π–ª–æ–≤–æ</h6>
                            <div class="event-location">–ù–∞—Ä–æ–¥–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 17</div>
                            <p style="font-size: 14px; color: #555;">–°–±–æ—Ä —É –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –í–∑—è—Ç—å —Å —Å–æ–±–æ–π: –ª–æ–ø–∞—Ç—É.</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: #888;"></span>
                                <button class="btn-volunteer"
                                    onclick="event.stopPropagation(); joinEvent('izmaily')">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –±–æ–Ω—É—Å–æ–≤ -->
            <div class="row">
                <div class="col-12 mt-4">
                    <div class="bonuses-card">
                        <h4 style="color: #112b00; margin-bottom: 25px; text-align: center;">–í–æ–ª–æ–Ω—Ç–µ—Ä—ã—à–∏</h4>

                        <div class="bonuses-grid">
                            <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã -->
                            <div class="bonus-category">
                                <div class="category-header">
                                    <div class="category-icon">üï∂Ô∏è</div>
                                    <h5>–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã</h5>
                                </div>
                                <div class="bonus-items">
                                    <div class="bonus-item">
                                        <span class="bonus-text">–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –º–µ—Ä—á</span>
                                    </div>
                                    <div class="bonus-item">
                                        <span class="bonus-text">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</span>
                                    </div>
                                    <div class="bonus-item">
                                        <span class="bonus-text">–ö–Ω–∏–≥–∏ –Ω–∞ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é —Ç–µ–º–∞—Ç–∏–∫—É</span>
                                    </div>
                                </div>
                            </div>

                            <!-- –ù–µ–º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã -->
                            <div class="bonus-category">
                                <div class="category-header">
                                    <div class="category-icon">‚≠ê</div>
                                    <h5>–û–ø—ã—Ç –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</h5>
                                </div>
                                <div class="bonus-items">
                                    <div class="bonus-item">
                                        <span class="bonus-text">–£—á–∞—Å—Ç–∏–µ –≤ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö</span>
                                    </div>
                                    <div class="bonus-item">
                                        <span class="bonus-text">–°–∫–∏–¥–∫–∏ —É –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</span>
                                    </div>
                                </div>
                            </div>

                            <!-- –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
                            <div class="bonus-category">
                                <div class="category-header">
                                    <div class="category-icon">üèõÔ∏è</div>
                                    <h5>–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å</h5>
                                </div>
                                <div class="bonus-items">
                                    <div class="bonus-item">
                                        <span class="bonus-text">–ò–º—è –Ω–∞ –¥–æ—Å–∫–µ –ø–æ—á–µ—Ç–∞</span>
                                    </div>
                                    <div class="bonus-item">
                                        <span class="bonus-text">–ë–ª–∞–≥–æ–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="bonus-footer text-center mt-4">
                            <p style="color: #454545; font-size: 14px; margin: 0;">
                                <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å—ã:</strong> –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö, –Ω–∞–∫–∞–ø–ª–∏–≤–∞–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                                –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ container -->
    </div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ map-page -->

    <!-- –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã API -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=–≤–∞—à_api_–∫–ª—é—á&lang=ru_RU" type="text/javascript"></script>

    <script>
        let map;
        let placemarks = [];

        // –§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
        function focusOnEvent(eventId) {
            const eventData = getEventData(eventId);
            if (eventData && placemarks[eventId]) {
                map.setCenter([eventData.coords[0], eventData.coords[1]], 16);
                placemarks[eventId].balloon.open();
                document.querySelectorAll('.event-card').forEach(card => card.classList.remove('active'));
                document.getElementById(`card-${eventId}`).classList.add('active');
            }
        }

        function joinEvent(eventId) {
            alert('–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ');
        }

        // –î–∞–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        function getEventData(eventId) {
            const events = {
                'gorky': {
                    coords: [55.728955, 37.603579],
                    title: '–£–±–æ—Ä–∫–∞ –≤ –ü–∞—Ä–∫–µ –ì–æ—Ä—å–∫–æ–≥–æ',
                    time: '–ó–∞–≤—Ç—Ä–∞, 10:00-13:00',
                    address: '–ö—Ä—ã–º—Å–∫–∏–π –í–∞–ª, 9',
                    description: '–°–±–æ—Ä —É –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è. –û–±–µ–¥ –≤–∫–ª—é—á–µ–Ω.'
                },
                'neskuchny': {
                    coords: [55.709683, 37.597258],
                    title: '–£–±–æ—Ä–∫–∞ –≤ –ù–µ—Å–∫—É—á–Ω–æ–º —Å–∞–¥—É',
                    time: '15 –¥–µ–∫–∞–±—Ä—è, 14:00-17:00',
                    address: '–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 20',
                    description: '–£–±–æ—Ä–∫–∞ –æ–ø–∞–≤—à–µ–π –ª–∏—Å—Ç–≤—ã –∏ –º—É—Å–æ—Ä–∞. –†–∞–±–æ—Ç–∞ –≤ –Ω–µ–±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø–∞—Ö.'
                },
                'sokolniki': {
                    coords: [55.791348, 37.677933],
                    title: '–£–±–æ—Ä–∫–∞ –≤ –°–æ–∫–æ–ª—å–Ω–∏–∫–∞—Ö',
                    time: '20 –¥–µ–∫–∞–±—Ä—è, 11:00-14:00',
                    address: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∏–π –í–∞–ª, 1',
                    description: '–†–∞—Å—á–∏—Å—Ç–∫–∞ –¥–æ—Ä–æ–∂–µ–∫ –æ—Ç —Å–Ω–µ–≥–∞ –∏ —É–±–æ—Ä–∫–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –¢–µ–ø–ª—ã–π —á–∞–π –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.'
                },
                'izmaily': {
                    coords: [55.787152, 37.771609],
                    title: '–ü—Ä–µ–¥–Ω–æ–≤–æ–≥–æ–¥–Ω—è—è —É–±–æ—Ä–∫–∞ –≤ –ò–∑–º–∞–π–ª–æ–≤–æ',
                    time: '25 –¥–µ–∫–∞–±—Ä—è, 12:00-15:00',
                    address: '–ù–∞—Ä–æ–¥–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 17',
                    description: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∫–∞ –∫ –ù–æ–≤–æ–º—É –≥–æ–¥—É. –£–∫—Ä–∞—à–µ–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏.'
                }
            };
            return events[eventId];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            if (typeof ymaps === 'undefined') {
                document.getElementById('map').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #e1e5ec; color: #666; text-align: center; padding: 20px;">
                        <div>
                            <h4>–ö–∞—Ä—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h4>
                            <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞ —Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏</p>
                        </div>
                    </div>
                `;
                return;
            }

            ymaps.ready(function () {
                map = new ymaps.Map('map', {
                    center: [55.7558, 37.6173],
                    zoom: 11,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                const eventIds = ['gorky', 'neskuchny', 'sokolniki', 'izmaily'];

                eventIds.forEach(eventId => {
                    const eventData = getEventData(eventId);
                    if (eventData) {
                        const placemark = new ymaps.Placemark(
                            eventData.coords,
                            {
                                balloonContentHeader: `<div class="balloon-title">${eventData.title}</div>`,
                                balloonContentBody: `
                                    <div class="balloon-time">${eventData.time}</div>
                                    <div>üìç ${eventData.address}</div>
                                    <div style="margin-top: 10px;">${eventData.description}</div>
                                    <button onclick="joinEvent('${eventId}')" style="margin-top: 10px; background: #8bc34a; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer;">
                                        –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                                    </button>
                                `,
                                hintContent: eventData.title
                            },
                            {
                                preset: 'islands#greenIcon',
                                balloonCloseButton: true,
                                hideIconOnBalloonOpen: false
                            }
                        );

                        placemark.events.add('click', function () {
                            document.querySelectorAll('.event-card').forEach(card => card.classList.remove('active'));
                            document.getElementById(`card-${eventId}`).classList.add('active');
                        });

                        map.geoObjects.add(placemark);
                        placemarks[eventId] = placemark;
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–µ–Ω—é
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            const menuButton = document.getElementById('menuButton');
            sidebar.classList.toggle('active');
            menuButton.classList.toggle('active');
        }

        function closeMenu() {
            const sidebar = document.getElementById('sidebar');
            const menuButton = document.getElementById('menuButton');
            sidebar.classList.remove('active');
            menuButton.classList.remove('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function () {
            initMap();
            const menuButton = document.getElementById('menuButton');
            const sidebar = document.getElementById('sidebar');

            if (menuButton && sidebar) {
                menuButton.addEventListener('click', function (e) {
                    e.stopPropagation();
                    toggleMenu();
                });

                document.addEventListener('click', function (e) {
                    if (sidebar.classList.contains('active') &&
                        !sidebar.contains(e.target) &&
                        !menuButton.contains(e.target)) {
                        closeMenu();
                    }
                });
            }
        });
    </script>
</body>

</html>